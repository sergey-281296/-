global
    log /dev/log local0
    log /dev/log local1 notice
    chroot /var/lib/haproxy
    stats socket /run/haproxy/admin.sock mode 660 level admin
    stats timeout 30s
    user haproxy
    group haproxy
    daemon

defaults
    log global
    mode http
    option httplog
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend http_front
    bind *:80
    acl host_example hdr(host) -i example.local
    use_backend http_back if host_example
    
    # Блокируем трафик не для example.local
    default_backend static_backend

backend http_back
    balance roundrobin
    server server1 127.0.0.1:8001 weight 2 check
    server server2 127.0.0.1:8002 weight 3 check
    server server3 127.0.0.1:8003 weight 4 check

backend static_backend
    mode http
    errorfile 503 /etc/haproxy/errors/503.http
    errorfile 200 /etc/haproxy/errors/deny.http
